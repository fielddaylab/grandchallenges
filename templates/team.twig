<!DOCTYPE html>
<html>
<head>
<title>Grand Challenges</title>
<link rel="stylesheet" type="text/css" href="css/styles.css">
<script type="text/javascript" src="js/zepto.min.js"></script>

<script type="text/javascript">

var available_faculty = [
];

var faculty = {% if data.team.faculty %}
  {{ data.team.faculty|json_encode()|raw }}
{% else %}
  {}
{% endif %};
var community = {% if data.team.community %}
  {{ data.team.community|json_encode()|raw }}
{% else %}
  []
{% endif %};

function clickFaculty(e) {
  e.preventDefault();
  $(document.body).addClass('viewing-faculty').removeClass('viewing-community');
}

function clickCommunity(e) {
  e.preventDefault();
  $(document.body).removeClass('viewing-faculty').addClass('viewing-community');
}

function removeFaculty(name) {
  delete faculty[name];
  $('#faculty-list input[type=checkbox][value=\"'+name+'\"]').prop('checked', false);
  showList();
}

function removeCommunity(index) {
  community.splice(index, 1);
  showList();
}

function showList() {
  $('#members-list').html((function(){
    var str = '';
    Object.keys(faculty).forEach(function(fac){
      str += '<p class="member-entry"><a href="#" class="member-x" onClick="removeFaculty(\''+fac+'\'); return false;"><img src="img/x.png"></a><span>'+fac+'</span></p>';
    });
    community.forEach(function(com, i){
      str += '<p class="member-entry"><a href="#" class="member-x" onClick="removeCommunity('+i+'); return false;"><img src="img/x.png"></a><span>' + com.last_name + ', ' + com.first_name + '</span></p>';
    });
    return str;
  })());
}

function toggleFacultyBox(box, name) {
  if (box.checked) {
    faculty[name] = true;
  } else {
    delete faculty[name];
  }
  showList();
}

function fillFacultyList() {
  var list = $('#faculty-list');
  available_faculty.forEach(function(fac){
    list.append(
      '<p>' +
        '<label>' +
          '<input type="checkbox" onclick="toggleFacultyBox(this, \''+fac+'\')" value="'+fac+'">' +
          ' ' + fac +
        '</label>' +
      '</p>'
    );
  });
}

$(function(){
  fillFacultyList();
  showList();
  $('#add-faculty').click(clickFaculty);
  $('#add-community').click(clickCommunity);
  $('#community-plus').click(function(e){
    e.preventDefault();
    var obj = {
      first_name: $('#community-first-name').val(),
      last_name: $('#community-last-name').val(),
      email: $('#community-email').val(),
      bio: $('#community-bio').val(),
    };
    var empty = [];
    if (!obj.first_name.match(/\S/)) empty.push('first name');
    if (!obj.last_name.match(/\S/)) empty.push('last name');
    if (!obj.email.match(/\S/)) empty.push('email address');
    if (!obj.bio.match(/\S/)) empty.push('team contribution');
    if (empty.length !== 0) {
      alert('Please fill out these missing fields: ' + empty.join(', ') + '.');
      return;
    }
    community.push(obj);
    $('#community-first-name').val('');
    $('#community-last-name').val('');
    $('#community-email').val('');
    $('#community-bio').val('');
    showList();
  });
  $('#next-button').click(function(){
    $('#hidden-json').val(JSON.stringify({
      faculty: faculty,
      community: community,
    }));
    $('#hidden-form').submit();
  });
});

</script>

</head>
<body>

<form class="hidden-form" id="hidden-form" method="post" action="save-team">
  <input type="text" name="json" id="hidden-json">
</form>

{{ include('nav.twig') }}

<div class="concept-hero">
  <div class="concept-hero-title">
    <h1>Hello {{ netid }}</h1>
    <h2>Welcome to the Grand Challenges</h2>
  </div>
</div>

<div class="concept-tab-bar">
  <a href="." class="concept-tab-bar-item concept-tab-bar-item-active">
    Dashboard
  </a>
</div>

<div class="concept-columns">
  <div class="concept-column concept-column-left">
    <div class="concept-map-chunk">
      <img src="img/map-pipe.png">
    </div>
    <div class="concept-map-chunk concept-map-current">
      <img src="img/map-checked.png">
      <a href="meeting"><span>Meet with Network</span></a>
    </div>
    <div class="concept-map-chunk concept-map-current">
      <img src="img/map-checked.png">
      <a href="bio"><span>Project Info</span></a>
    </div>
    <div class="concept-map-chunk concept-map-current">
      <img src="img/map-orange.png">
      <a href="team"><span>Your Team</span></a>
    </div>
    <div class="concept-map-chunk">
      <img src="img/map-gray.png">
      <a href="support"><span>Optional Support</span></a>
    </div>
    <div class="concept-map-chunk">
      <img src="img/map-gray-end.png">
      <a href="line"><span>Choose Your Path</span></a>
    </div>
  </div>
  <div style="width: 100%;">
    <div class="concept-columns-nav">
      <a href="bio">
        <div class="concept-columns-nav-side concept-columns-nav-side-left">
          <img src="img/arrow-gold-left.png">
          <span>Project Info</span>
        </div>
      </a>
      <a href="support">
        <div class="concept-columns-nav-side concept-columns-nav-side-right">
          <span>Optional Support</span>
          <img src="img/arrow-gold-right.png">
        </div>
      </a>
    </div>
    <div class="concept-columns">
      <div class="concept-column concept-column-middle bio-form">
        <h2>
          <img src="img/connect-dot.png">
          Set up your team
        </h2>
        <div class="team-instructions">
          <p>
            Each team must include at least two members of the UW-SOE faculty and/or staff community. If the focus of your Grand Challenge is community impact, please include relevant community partners on your team.
          </p>
        </div>
        <div class="team-halves">
          <div class="big-form-split">
            <p>
              <label>
                First Name<br>
                <input type="text" id="community-first-name">
              </label>
            </p>
            <p>
              <label>
                Last Name<br>
                <input type="text" id="community-last-name">
              </label>
            </p>
          </div>
          <p>
            <label>
              Email<br>
              <input type="text" id="community-email">
            </label>
          </p>
          <p>
            <label>
              What does this person bring to the team? (140 chars)<br>
              <textarea id="community-bio"></textarea>
            </label>
          </p>
          <p>
            <a href="#" id="community-plus"><img src="img/plus.png"></a>
          </p>
        </div>
        <p>
          <button class="button-brown button-brown-filled" id="next-button" type="button">Save and Continue</button>
        </p>
      </div>
      <div class="concept-column concept-column-right">
        <h3>Your team:</h3>
        <div class="big-form-middle-side">
          <p class="member-entry">
            <a href="#" class="member-x" onclick="return false;">
              <img src="img/x.png">
            </a>
            <span>{{ netid }} (You)</span>
          </p>
          <div id="members-list">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{{ include('footer.twig') }}

</body>
</html>
